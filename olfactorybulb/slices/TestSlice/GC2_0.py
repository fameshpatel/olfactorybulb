
from neuron import h

class TransformGC2:
    def __init__(self):

        # Create a section lookup by section name
        # Note: this assumes each section has a unique name
        self.name2section = { sec.name(): sec for sec in h.allsec() }

        # This will store the new section coordinates
        self.section_coords = { }

    def set_coords(self, sec_name):
        # Lookup the section
        nrn_section = self.name2section[sec_name]

        # Lookup its new coords
        new_coords = self.section_coords[sec_name]

        # Use 3D points as section L and diam sources
        h.pt3dconst(1, sec=nrn_section)

        # Clear the existing points - and allocate room for the incoming points
        h.pt3dclear(len(new_coords["diam"]), sec=nrn_section)

        # Use vectorization to add the points to section
        xvec = h.Vector(new_coords["x"])
        yvec = h.Vector(new_coords["y"])
        zvec = h.Vector(new_coords["z"])
        dvec = h.Vector(new_coords["diam"])

        h.pt3dadd(xvec, yvec, zvec, dvec, sec=nrn_section)

    def set_all(self):
        for sec_name in self.section_coords.keys():
            self.set_coords(sec_name)

    @staticmethod
    def apply_on(prefix):
        t = TransformGC2()
        t.define_coords(prefix)
        t.set_all()

    @staticmethod
    def apply():
        t = TransformGC2()
        t.define_coords()
        t.set_all()

    def define_coords(self, prefix = 'GC2[0]'):
        if prefix != '':
            prefix += '.'

        self.section_coords = {
          prefix + 'apic[8]': {
              'x':[343.367,344.612,345.152,345.315,345.160,345.050,345.095,345.138,345.237,345.354,345.386,345.544,345.764,345.964,346.153,346.271,346.570,346.986,347.347,347.619,347.784,347.922,348.109,348.276,348.277,348.352,348.456,348.598,348.919,349.276,349.360,349.304,349.127,348.920,348.539,348.132,347.787,347.559,347.448,347.263,347.208,347.198,347.032,346.875,346.365,345.864,345.504,345.284,345.008,344.793,344.480,344.276,344.288,343.887,343.146,342.733,342.212,341.865,341.779,341.721,341.336,340.964,340.518,340.108,340.106,340.438,340.791,341.130,341.239,341.485,341.903,341.844,341.799,341.894,342.259,342.580,342.833,343.045,343.125,343.067,343.026,343.107,344.344,344.735,344.680,344.640,344.435,344.426,344.454,344.208,343.947,343.914,344.020,343.847],
              'y':[1430.605,1434.783,1435.801,1436.990,1438.288,1439.582,1440.890,1442.176,1443.410,1444.652,1445.941,1447.186,1448.404,1449.628,1450.847,1452.142,1453.396,1454.545,1455.707,1457.030,1458.329,1459.659,1460.822,1461.955,1463.238,1464.475,1465.687,1466.933,1468.144,1469.312,1470.521,1471.816,1473.116,1474.419,1475.618,1476.839,1478.120,1479.419,1480.739,1482.024,1483.330,1484.627,1485.917,1487.228,1488.512,1489.794,1491.090,1492.390,1493.700,1494.986,1496.232,1497.457,1498.751,1500.030,1501.279,1502.566,1503.831,1505.123,1506.418,1507.668,1508.583,1509.742,1510.937,1512.195,1513.430,1514.516,1515.695,1516.955,1518.263,1519.602,1520.843,1521.781,1522.875,1524.066,1525.388,1526.722,1528.038,1529.362,1530.673,1531.919,1533.161,1534.310,1534.692,1534.916,1535.316,1536.103,1536.643,1537.120,1537.696,1538.567,1539.512,1540.490,1541.009,1541.174],
              'z':[85.829,83.824,83.191,82.682,82.309,82.117,81.967,81.758,81.312,80.894,80.687,80.266,79.818,79.361,78.911,78.709,78.468,77.984,77.521,77.480,77.454,77.349,76.826,76.214,75.943,75.465,74.943,74.552,74.246,73.742,73.229,72.981,72.883,72.946,73.272,73.525,73.455,73.298,73.203,73.363,73.389,73.317,73.467,73.419,73.131,72.842,72.561,72.310,72.159,72.199,72.481,72.691,72.486,72.308,72.132,71.864,71.451,71.055,70.802,70.986,71.845,72.300,72.546,72.566,72.204,71.525,71.051,70.792,70.867,71.067,71.761,72.833,73.732,74.502,74.832,74.974,75.035,75.309,75.545,75.951,76.406,77.006,78.498,79.712,81.142,82.385,83.693,84.578,85.414,86.453,87.403,88.450,89.342,90.780],
              'diam':[0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592]
          },

          prefix + 'apic[0]': {
              'x':[282.414,283.872,285.120,286.868,288.257,290.043,291.621,293.195,295.306,296.314,297.434,298.805,299.980,300.892,301.897,303.210,304.631,305.694,306.474,307.345,308.341,309.189,309.965,310.591,310.572,311.354,312.169,313.320,314.610,315.725,316.575,317.258,317.961,318.851,320.184,321.497,322.174,322.378,323.913,324.555,326.052],
              'y':[1403.393,1403.662,1404.164,1405.032,1405.413,1405.664,1405.866,1406.323,1406.913,1407.295,1407.670,1408.016,1408.406,1408.818,1409.152,1409.366,1409.530,1409.683,1409.866,1410.058,1410.230,1410.387,1410.541,1410.831,1410.844,1410.899,1411.059,1411.232,1411.411,1411.590,1411.770,1411.918,1412.007,1412.061,1412.197,1412.392,1412.593,1412.903,1413.001,1412.993,1413.107],
              'z':[38.887,39.867,40.716,41.903,42.784,43.761,44.444,44.591,45.664,46.498,47.392,48.420,49.246,49.857,50.663,51.807,53.069,54.159,55.111,56.103,57.124,58.086,58.983,60.354,61.378,62.850,63.794,64.891,66.069,67.200,68.208,69.113,70.045,71.044,72.239,73.410,74.266,75.398,77.213,78.093,79.906],
              'diam':[0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592]
          },

          prefix + 'apic[2]': {
              'x':[332.835,334.509,335.381,336.526,337.471,338.833,340.413,341.786,343.470,344.724,346.680,347.918,348.995,350.148,351.535,352.754,354.020,354.888,356.555,357.721,359.254,360.862,361.704,363.245,364.802,365.798,367.362,368.639,370.194,372.174,373.878,375.623,376.673,377.613,378.528,380.238,381.461,383.134,384.618,386.423,387.946,389.062,390.387,391.975,393.630,394.953,396.272,397.374,398.720,399.862,400.827,402.107,403.691,405.047,406.283,407.672,409.156,411.125,413.144,414.416],
              'y':[1413.676,1414.011,1414.473,1414.605,1414.490,1414.535,1414.678,1414.875,1415.309,1415.351,1415.428,1415.869,1416.390,1416.596,1416.818,1417.011,1417.399,1417.893,1418.380,1418.437,1418.250,1418.441,1418.870,1419.339,1419.509,1419.504,1419.606,1419.774,1419.884,1419.810,1419.851,1420.004,1420.158,1420.367,1420.710,1421.054,1421.580,1422.235,1422.419,1422.375,1422.358,1422.375,1422.431,1422.724,1422.999,1423.149,1423.277,1423.457,1424.031,1424.634,1424.920,1425.139,1425.252,1425.263,1425.269,1425.276,1425.362,1425.423,1425.364,1425.158],
              'z':[84.927,85.699,85.424,84.625,84.229,84.172,84.896,85.456,85.689,85.527,85.872,85.793,85.692,86.083,86.631,87.063,86.988,86.703,87.017,86.795,86.276,86.379,86.024,86.211,86.282,86.506,87.191,87.635,87.660,88.059,88.884,89.730,89.988,89.596,89.242,89.443,89.408,89.853,89.897,90.110,90.112,89.832,89.701,89.786,89.941,90.370,90.818,91.116,91.211,91.209,90.855,90.142,90.208,90.678,91.037,90.936,91.000,92.125,93.363,94.047],
              'diam':[0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592]
          },

          prefix + 'apic[6]': {
              'x':[326.052,325.737,326.003,326.409,327.781,328.722,329.362,330.085,330.702,331.376,332.124,333.766,334.893,335.850,336.780,337.842,338.697,339.391,340.088,341.064,342.163,343.367],
              'y':[1413.107,1414.405,1415.684,1417.008,1417.872,1418.711,1419.542,1420.400,1421.258,1422.101,1422.931,1423.740,1424.581,1425.410,1425.823,1426.668,1427.529,1428.342,1429.144,1429.851,1430.199,1430.605],
              'z':[79.906,79.945,80.595,81.000,81.810,82.045,82.071,82.194,82.234,82.332,82.390,83.078,83.443,83.667,84.104,84.448,84.694,84.691,84.658,84.695,85.192,85.829],
              'diam':[0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592]
          },

          prefix + 'apic[3]': {
              'x':[332.835,331.744,331.688,331.348],
              'y':[1413.676,1413.583,1413.764,1413.803],
              'z':[84.927,85.229,86.217,87.351],
              'diam':[0.592,0.592,0.592,0.592]
          },

          prefix + 'apic[5]': {
              'x':[331.348,329.528,328.449,327.784,327.215,326.883,326.638,327.441,327.673,327.353,327.062,326.870,326.752,326.714,326.943,327.674,328.260,328.289,328.879,329.218,329.175,329.056,329.074,329.070,328.928,328.739,329.148,330.345,331.143,331.574,332.129,332.463,332.536,332.545,332.386,332.196,332.220,332.282,332.158,331.870,331.891,332.153,332.138,332.210,332.176,332.415,333.207,333.411,335.189,336.443,337.399,338.301,338.999,339.759,340.179,339.862,339.152,338.354,337.595,336.877,336.363,335.873,335.633,335.686,335.731,335.585,335.568,335.581,335.543,335.564,335.374,335.285,335.294,335.372,335.421,335.540,335.727,335.866,336.367,336.532,336.441,336.174,336.825,337.148,337.064,337.106,337.080,336.924,337.237,338.034,338.458,338.169,337.855,337.862,338.054,338.564,339.577],
              'y':[1413.803,1413.389,1412.946,1412.436,1412.024,1411.398,1411.098,1411.109,1411.128,1410.848,1410.409,1409.926,1409.867,1409.937,1409.951,1409.964,1410.004,1409.988,1409.912,1409.823,1409.714,1409.418,1409.237,1409.172,1409.026,1408.906,1408.617,1408.657,1408.784,1408.994,1409.261,1409.461,1409.472,1409.453,1409.494,1409.263,1408.928,1408.669,1408.715,1408.918,1408.994,1409.173,1409.324,1409.292,1409.279,1409.209,1409.118,1408.844,1408.894,1409.079,1409.262,1409.452,1409.971,1410.589,1411.044,1411.903,1412.101,1411.442,1410.468,1409.950,1410.084,1410.260,1409.790,1409.013,1408.644,1408.151,1407.975,1408.059,1408.130,1408.113,1408.165,1407.719,1407.444,1407.486,1407.775,1408.133,1408.482,1408.716,1408.950,1409.253,1409.393,1409.199,1409.211,1409.327,1408.989,1408.976,1409.140,1409.472,1409.593,1409.670,1409.747,1409.359,1408.818,1408.051,1407.503,1406.943,1406.311],
              'z':[87.351,87.007,87.321,88.336,89.427,90.576,91.930,93.414,94.585,95.886,97.153,98.459,99.929,100.942,102.106,102.994,103.844,104.888,106.259,107.490,108.484,109.912,110.940,111.980,113.432,114.878,116.582,117.712,118.661,119.962,121.309,122.532,123.618,124.671,126.131,127.532,128.494,129.527,130.999,132.367,133.935,135.120,136.158,137.238,138.273,139.432,140.930,142.033,143.958,145.104,146.116,147.113,148.382,149.622,150.795,151.789,152.821,153.590,154.144,155.091,156.301,157.535,158.771,160.037,160.990,162.341,163.338,164.391,165.404,166.464,167.899,169.287,170.259,171.334,172.365,173.411,174.507,175.611,176.924,178.022,179.489,180.876,182.239,183.451,184.898,185.962,186.967,188.390,190.115,191.064,192.324,193.590,194.786,196.009,196.906,197.955,199.142],
              'diam':[0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592]
          },

          prefix + 'apic[1]': {
              'x':[326.052,327.126,328.965,331.168,332.835],
              'y':[1413.107,1413.258,1413.320,1413.491,1413.676],
              'z':[79.906,80.866,82.392,83.874,84.927],
              'diam':[0.592,0.592,0.592,0.592,0.592]
          },

          prefix + 'soma': {
              'x':[282.436,282.127,281.817],
              'y':[1403.176,1403.357,1403.539],
              'z':[38.305,38.607,38.909],
              'diam':[0.938,0.938,0.938]
          },

          prefix + 'apic[4]': {
              'x':[331.348,331.549,331.495,331.783,333.417,334.582,335.194,335.532,336.208,336.417,336.369,336.242,337.116,337.781,338.436,338.782,338.947,339.114,339.293,340.393,340.798,340.781,341.015,341.933,343.209,344.099,344.679,344.785,344.832,344.615,344.443,344.730,345.663,346.639,347.086,347.088,347.145,347.230,347.357,347.486,347.354,347.315,347.040,346.991,346.919,346.683,346.640,347.066,347.730,348.173,348.224,349.803,350.553,351.031,351.701,352.257,352.991,353.067,352.967,352.709,352.889,353.764,353.931,353.932,354.160,354.276,354.911,356.582],
              'y':[1413.803,1414.212,1415.105,1415.852,1416.342,1416.375,1416.438,1416.606,1416.721,1417.079,1417.386,1417.559,1417.628,1417.584,1417.606,1417.819,1418.121,1418.485,1418.851,1419.283,1419.650,1419.759,1419.670,1419.728,1419.987,1420.357,1420.946,1421.239,1421.379,1421.693,1422.000,1422.309,1422.412,1422.480,1422.636,1422.927,1423.153,1423.355,1423.740,1424.311,1424.946,1425.198,1425.359,1425.576,1425.778,1425.963,1426.303,1426.863,1427.142,1427.571,1428.165,1428.838,1429.440,1429.937,1430.021,1430.025,1430.144,1430.257,1430.810,1431.910,1432.648,1433.127,1433.445,1433.774,1433.790,1433.599,1433.509,1433.530],
              'z':[87.351,88.656,89.771,90.462,92.160,93.293,94.143,95.375,96.810,97.904,98.874,100.328,101.849,102.737,103.591,104.801,105.899,106.977,108.062,109.678,110.896,111.913,113.061,114.022,115.119,115.936,117.062,118.122,119.173,120.564,121.986,123.130,124.118,125.182,126.467,127.458,128.506,129.576,130.626,131.524,132.818,133.800,135.182,136.169,137.147,138.550,140.021,141.051,141.827,142.987,143.802,145.382,146.585,147.722,148.577,149.425,150.889,151.975,153.268,153.976,154.655,156.064,157.150,158.141,159.290,160.371,161.713,163.079],
              'diam':[0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592]
          },

          prefix + 'apic[7]': {
              'x':[343.367,344.647,345.271,345.901,346.555,347.678,348.905,350.330,351.526,353.082,353.893,354.898,355.784,356.464,357.199,357.932,358.701,359.571,361.404,362.584,363.591,365.395,366.550,367.740,369.064,369.945,370.754,371.380,372.437,373.519,374.654,375.862,376.931,378.113,379.409,380.815,381.861,382.847,383.610,384.234,384.961,386.203,387.806,388.775,389.730,390.637,391.810,392.675,393.610,394.518,395.500,396.450,397.274,398.304,399.135,399.929,401.006,401.765,402.502,403.399],
              'y':[1430.605,1431.467,1432.309,1433.108,1434.307,1434.616,1434.833,1435.365,1436.034,1436.583,1437.194,1437.774,1438.463,1439.224,1440.052,1440.847,1441.524,1442.112,1442.781,1443.536,1444.604,1445.194,1445.494,1446.196,1446.968,1447.663,1448.448,1449.220,1449.868,1450.125,1450.329,1450.845,1451.722,1452.139,1452.328,1452.538,1452.782,1453.401,1454.128,1454.952,1455.660,1456.108,1456.477,1457.223,1458.308,1459.226,1459.939,1460.402,1460.589,1460.606,1460.598,1460.769,1461.289,1462.237,1463.343,1464.583,1465.622,1466.277,1466.991,1467.693],
              'z':[85.829,86.362,86.399,86.415,85.985,86.566,87.017,87.233,87.356,87.584,87.359,87.238,87.189,87.102,87.140,87.151,86.955,86.742,87.331,87.563,87.285,87.801,88.263,88.429,88.770,88.680,88.725,88.609,88.586,88.898,89.234,89.197,88.719,88.584,89.058,89.610,89.917,89.811,89.710,89.709,89.593,88.953,89.235,89.387,89.074,88.554,87.997,87.673,87.286,86.841,86.457,86.051,85.776,85.348,85.007,84.913,84.659,84.432,84.310,84.247],
              'diam':[0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592,0.592]
          },


        }
